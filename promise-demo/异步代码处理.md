# JSå¼‚æ­¥ä»£ç å¤„ç†

> ä»¥ NodeJs è¯»å–æ–‡ä»¶ä¸ºä¾‹ 

â€‹	åœ¨index åŒçº§ç›®å½•ä¸‹æ–°å»ºä¸‰ä¸ªæ–‡ä»¶ a.json b.json c.sjon

![](./images/fileBuild.png)

ä¸‰ä¸ªæ–‡ä»¶éƒ½ä¸º json æ ¼å¼ï¼Œå†…å®¹åˆ†åˆ«å¦‚ä¸‹

```json
// a.json
{
  "message": "è¿™æ˜¯açš„æ•°æ®",
  "next": "b.json"
}

// b.json
{
  "message": "è¿™æ˜¯bçš„æ•°æ®",
  "next": "c.json"
}

// c.json
{
  "message": "è¿™æ˜¯cçš„æ•°æ®",
  "next": "null"
}
```

ç°åœ¨æƒ³è¦åœ¨indexä¸­é€æ­¥è·å– a.json æ‹¿åˆ°a.json åé€šè¿‡è¿”å›å€¼ä¸­çš„ next å±æ€§è·å–ä¸‹ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œä»¥æ­¤ç±»æ¨ç›´è‡³è·å–ä¸‰ä¸ªæ–‡ä»¶ä¸­çš„å…¨éƒ¨æ•°æ®



## è¯»å–æ–‡ä»¶æ ¸å¿ƒæ¨¡å—

- fs
  - `const fs = require('fs')` ä½¿ç”¨ node çš„æ ¸å¿ƒæ¨¡å— fs å¯ä»¥å¯¹æœ¬åœ°æ–‡ä»¶è¿›è¡Œè¯»å–å†™å…¥ç­‰æ“ä½œ
  - fs.readFile è¯»å–æ•°æ® ä¼ å…¥æ–‡ä»¶è·¯å¾„ä»¥åŠå›è°ƒæ“ä½œï¼Œå¦‚æœæˆåŠŸè¿”å› dataï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰ å¤±è´¥è¿”å› errorï¼ˆç¬¬ä¸€ä¸ªå‚æ•°) 
- path
  - `const path = require('path')` path æ¨¡å—ç”¨ä»¥å¤„ç†æ–‡ä»¶è·¯å¾„
  -  path.resolve() æ–¹æ³•å°†ç»™å®šçš„å‚æ•° ä»å³å‘å·¦é€æ­¥å¤„ç†ï¼Œç›´è‡³æ„é€ å‡ºä¸€ä¸ªç»å¯¹è·¯å¾„
  - __dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„



### å›è°ƒå‡½æ•°å¤„ç†å¼‚æ­¥

- å›è°ƒå‡½æ•°å¤„ç†å¼‚æ­¥æ˜¯ä¸€ç§è½®è¯¢çš„æ–¹å¼è¿›è¡Œ
  - å½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå†è°ƒç”¨å›è°ƒå‡½æ•°

```javascript
function getFileContent(filename, callback) {
  // è·å–æ•°æ®æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
  const fullFilename = path.resolve(__dirname, 'data', filename);

  fs.readFile(fullFilename, (err, data) => {
    if(err) {
      console.error(err)
      return
    }
    callback && callback(
      JSON.parse(data.toString())
    )
  })
}

getFileContent('a.json', (aData) => {
  onsole.log('aData', aData)
  getFileContent(aData.next, (bData) => {
    console.log('bData', bData)
    getFileContent(bData.next, (cData) => {
      console.log('cData', cData)
    })
  })
})
```

å›è°ƒå‡½æ•°å±‚å±‚åµŒå¥—è°ƒç”¨è¢«ç§°ä¸º **å›è°ƒåœ°ç‹±**

- å¯è¯»æ€§ä½
- éš¾ä»¥ç»´æŠ¤



### Promise å¤„ç†å¼‚æ­¥

- Promise åœ¨ä½¿ç”¨æ—¶éœ€è¦åˆ›å»ºå®ä¾‹ 
  - promiseæœ‰ä¸¤ä¸ªå¤„ç†æ–¹æ³• resolve å’Œ reject 
    - resolve å°†promise ä» padding çŠ¶æ€æ”¹å˜ä¸ºæˆåŠŸçŠ¶æ€
    - reject å°†promise ä» padding çŠ¶æ€æ”¹ä¸ºå¤±è´¥çŠ¶æ€
- åœ¨æ–¹æ³•æœ€å return åˆ›å»ºçš„å®ä¾‹åŒ–å¯¹è±¡ å¯ä»¥å®ç°é“¾å¼ç¼–ç¨‹

```javascript
function getFileContent(filename) {
  const promise = new Promise((resolve, reject) => {
    // æ–‡ä»¶ç»å¯¹è·¯å¾„
    const fullFilename = path.resolve(__dirname, 'data', filename);

    fs.readFile(fullFilename, (err, data) => {
      if (err) {
        reject(err)
        return
      }
      resolve(JSON.parse(data.toString()))
    })
  })
  return promise
}

getFileContent('a.json')
.then(aData => {
  console.log('aData', aData)
  return getFileContent(aData.next)
}).then(bData => {
  console.log('bData', bData)
  return getFileContent(bData.next)
}).then(cData => {
  console.log('cData', cData)
})	
```

1. ä½¿ç”¨ Promise å¤„ç†ä¸éœ€è¦æ¥æ”¶å›è°ƒå‡½æ•°ï¼Œåªéœ€è¦åœ¨ .thenä¸­æ¥æ”¶è¿”å›å€¼
2. ä½¿ç”¨ Promise æœ€å¤šåªæœ‰ä¸¤å±‚ 
3. é“¾å¼ç¼–ç¨‹éœ€è¦å°† Promise å¯¹è±¡è¿”å› ä¹Ÿå°±æ˜¯ä»£ç çš„ `return getFileContent(aData.next)`
   - æ­¤æ–¹æ³•çš„è¿”å›å€¼ä¸º promise 



### æ€»ç»“

 ä¸¤ç§å¼‚æ­¥ä»£ç çš„å¤„ç†è¿”å›ç»“æœç›¸åŒ

```javascript
aData { message: 'è¿™æ˜¯açš„æ•°æ®', next: 'b.json' }
bData { message: 'è¿™æ˜¯bçš„æ•°æ®', next: 'c.json' }
cData { message: 'è¿™æ˜¯cçš„æ•°æ®', next: 'null' }
```

ä½†ä¸¤è€…åœ¨å®ç°ä¸Šå¤§ç›¸å¾„åº­ï¼Œç›¸æ¯”ä¹‹ä¸‹ Promise çš„å®ç°æ›´ä¸ºç®€æ´æ–¹ä¾¿ï¼Œå¯è¯»æ€§é«˜ï¼Œç»´æŠ¤æ€§å¥½

ğŸ‘‰ [è·å–ä»£ç ](https://github.com/XXXieChenHao/Node/tree/master/promise-demo)



ã€ğŸ˜Š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„é“¾æ¥ã€‘



